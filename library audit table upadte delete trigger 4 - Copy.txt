4: Write a database trigger on Library table. The System should keep track of the
records that are being updated or deleted. The old value of updated or deleted records
should be added in Library_Audit table.
CREATE TABLE Library (
bid INT PRIMARY KEY,
bname VARCHAR(100),
doi DATE,
-- date of issue or relevant date
status VARCHAR(20)
);
CREATE TABLE Library_Audit (
audit_id INT AUTO_INCREMENT PRIMARY KEY,
bid INT,
bname VARCHAR(100),
doi DATE,
status VARCHAR(20),
action VARCHAR(10),
-- 'UPDATE' or 'DELETE'

timestampofquery TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

DELIMITER $$
-- Trigger for UPDATE
CREATE TRIGGER trg_library_update
AFTER UPDATE ON Library
FOR EACH ROW
BEGIN
INSERT INTO Library_Audit (bid, bname, doi, status, action)
VALUES (OLD.bid, OLD.bname, OLD.doi, OLD.status, 'UPDATE');
END$$
-- Trigger for DELETE
CREATE TRIGGER trg_library_delete
AFTER DELETE ON Library
FOR EACH ROW
BEGIN
INSERT INTO Library_Audit (bid, bname, doi, status, action)
VALUES (OLD.bid, OLD.bname, OLD.doi, OLD.status, 'DELETE');
END$$
DELIMITER ;

-- Insert sample data
INSERT INTO Library (bid, bname, doi, status) VALUES (1, 'Database Concepts', CURDATE(), 'ISSUE');
INSERT INTO Library (bid, bname, doi, status) VALUES (2, 'Operating Systems', CURDATE(), 'ISSUE');
-- Update a record
UPDATE Library SET status = 'RETURN' WHERE bid = 1;
-- Delete a record
DELETE FROM Library WHERE bid = 2;
-- Check audit logs
SELECT * FROM Library_Audit;